---
import BlogLayout from '../../layouts/BlogLayout.astro'
import { calculateReadingTime, calculateWordCount } from '../../utils'

export async function getStaticPaths() {
	const allPosts: any[] = Object.values(
		import.meta.glob('../../content/blog/*.{md,mdx}', { eager: true })
	)

	return allPosts.map((post: any) => ({
		params: {
			slug:
				post.file
					.split('/')
					.pop()
					?.replace(/\.(md|mdx)$/, '') || ''
		},
		props: { post }
	}))
}

const { post } = Astro.props
const { Content, frontmatter } = post

// 计算文章统计信息
const content = await post.compiledContent()
const readingTime = calculateReadingTime(content)
const wordCount = calculateWordCount(content)
---

<BlogLayout frontmatter={frontmatter} readingTime={readingTime} wordCount={wordCount}>
	<Content />
</BlogLayout>
